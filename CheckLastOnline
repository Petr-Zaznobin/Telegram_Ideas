import time

from pyrogram import Client
from pyrogram import enums
from pyrogram.handlers import UserStatusHandler

# Ваш API_ID и API_HASH
API_ID = API_ID
API_HASH = "API_HASH"

prey_username = "@prey_name"
# Создание клиента Pyrogram
app = Client("check_online", api_id=API_ID, api_hash=API_HASH)


# Асинхронная функция для проверки статуса пользователя
async def check_user_status():
    is_online = False
    is_offline = False
    while True:
        async with app:
            user = await app.get_users(prey_username)
            status = user.status
            first_name = user.first_name

            if is_online is False and is_offline is False:
                if status == UserStatus.ONLINE:
                    print(f"Пользователь {first_name} онлайн")
                    is_online = True
                elif status in [UserStatus.OFFLINE, UserStatus.RECENTLY]:
                    print(f"Пользователь {first_name} не в сети")
                    is_offline = True
            elif is_online is True and is_offline is False:
                if status in [UserStatus.OFFLINE, UserStatus.RECENTLY]:
                    print(f"Пользователь {first_name} был в сети в {time.strftime('%Y-%m-%d %H:%M:%S')}")
                    is_offline = True
                    is_online = False
            elif is_online is False and is_offline is True:
                if status == UserStatus.ONLINE:
                    print(f"Пользователь {first_name} снова онлайн")
                    is_online = True
                    is_offline = False

        time.sleep(3)

# Запуск клиента Pyrogram
app.run(check_user_status())
